---
- name: "Configure network interfaces (Add /etc/rc.conf.d/netif/* files)"
  template:
    src: "netif.j2"
    dest: "/etc/rc.conf.d/netif/{{ item.name }}"
  with_items: "{{ network_interfaces }}"
  when: item.configure
  tags:
    - "network"
  register: result

- name: "create network interfaces"
  command: "/sbin/ifconfig {{ item.interface }}{% if item.vlan is defined %}.{{ item.vlan }}{% endif %} || /sbin/ifconfig {{ item.interface }}{% if item.vlan is defined %}.{{ item.vlan }}{% endif %} create"
  ignore_errors: yes
  with_together:
    - "{{ network_interfaces }}"
    - "{{ result }}"
  when:
    - item.0.configure
  tags:
    - "network"

- name: "(Re-)Configure network interfaces (service netif restart $interface)"
  command: "/usr/sbin/service netif restart {{ item.interface }}{% if item.vlan is defined %}.{{ item.vlan }}{% endif %}"
  with_items: "{{ network_interfaces }}"
  with_together:
    - "{{ network_interfaces }}"
    - "{{ result }}"
  when:
    - item.0.configure
    - item.1.result.changed
  tags:
    - "network"
